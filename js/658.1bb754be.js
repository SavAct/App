"use strict";(globalThis["webpackChunksavactapp"]=globalThis["webpackChunksavactapp"]||[]).push([[658],{68658:(e,o,t)=>{t.r(o),t.d(o,{default:()=>te});var l=t(61758),n=t(58790),a=t(29104);const i={class:"row justify-between no-wrap"},s={class:"row q-mb-md"},u={key:0,class:"row q-mb-sm"},r={class:"q-mx-md"},c={class:"column items-center"},d={class:"text-center"},v={class:"row justify-between"},h={class:"row justify-between"},m={class:"col"},f={class:"q-ml-md"},g={class:"h4"};function p(e,o,t,p,y,b){const C=(0,l.g2)("bridge-select"),k=(0,l.g2)("q-card-section"),E=(0,l.g2)("q-card"),T=(0,l.g2)("q-btn"),I=(0,l.g2)("wallet-eosio"),w=(0,l.g2)("wallet-eth"),S=(0,l.g2)("q-item-label"),F=(0,l.g2)("q-item-section"),q=(0,l.g2)("q-item"),A=(0,l.g2)("q-list"),_=(0,l.g2)("q-menu"),B=(0,l.g2)("asset-field"),O=(0,l.g2)("q-icon"),x=(0,l.g2)("q-toggle"),$=(0,l.g2)("q-spinner-box"),H=(0,l.g2)("q-separator"),W=(0,l.g2)("teleport-list"),N=(0,l.g2)("q-page"),R=(0,l.gN)("close-popup");return(0,l.uX)(),(0,l.Wv)(N,{class:"column",style:{height:"100%"}},{default:(0,l.k6)((()=>[(0,l.Lk)("div",i,[(0,l.bF)(E,{class:"col q-mx-md q-my-sm card"},{default:(0,l.k6)((()=>[(0,l.bF)(k,{class:"q-py-none"},{default:(0,l.k6)((()=>[(0,l.bF)(C,{class:"q-mt-sm",contract:e.eosioContractModel,"onUpdate:contract":o[0]||(o[0]=o=>e.eosioContractModel=o),custom:e.customBridge,"onUpdate:custom":o[1]||(o[1]=o=>e.customBridge=o),selected:e.sBridge,"onUpdate:selected":o[2]||(o[2]=o=>e.sBridge=o),bridges:e.bridges,"onUpdate:bridges":o[3]||(o[3]=o=>e.bridges=o),onAddbridge:o[4]||(o[4]=o=>e.bridges.push(o))},null,8,["contract","custom","selected","bridges"])])),_:1})])),_:1}),(0,l.Lk)("div",null,[(0,l.bF)(T,{class:"q-py-md",style:{"border-radius":"0 0 0 5px"},size:"md","icon-right":"settings",color:"grey",to:{name:"setup-teleport",query:e.sBridge?{eosio:e.sEosioChain?e.sEosioChain.contract:void 0,eth:e.sEthChain?e.sEthChain.contract:void 0}:void 0}},null,8,["to"])])]),(0,l.bF)(E,{class:"q-mx-md q-my-sm card"},{default:(0,l.k6)((()=>[(0,l.bF)(k,null,{default:(0,l.k6)((()=>[(0,l.Lk)("div",s,[(0,l.bF)(I,{class:"col-12 col-sm",onAccount:e.getEosioBalance},null,8,["onAccount"])]),e.sEthChain?((0,l.uX)(),(0,l.CE)("div",u,[(0,l.bF)(w,{class:"col-12 col-sm",onConnected:e.ethConnectChanged,onAccount:e.setEthAccount,chainId:e.ethChainId,"onUpdate:chainId":o[5]||(o[5]=o=>e.ethChainId=o)},null,8,["onConnected","onAccount","chainId"])])):(0,l.Q3)("",!0)])),_:1})])),_:1}),(0,l.bo)((0,l.Lk)("div",r,[e.sBridge&&e.direction&&e.sEosioChain&&e.sEthChain?((0,l.uX)(),(0,l.CE)("div",{key:0,class:(0,n.C4)(["row justify-between q-mt-sm q-mb-md",0==e.direction.from?"":e.$q.screen.gt.xs?"reverse":"column reverse"])},[(0,l.bF)(E,{class:"col-12 col-sm-5 col-md-4 column items-center bg-primary"},{default:(0,l.k6)((()=>[(0,l.bF)(k,{class:"full-width"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",null,[(0,l.bF)(T,{color:"primary",label:e.sEosioChain.shortName,"icon-right":e.sBridge.eosio.length>1?"arrow_drop_down":""},{default:(0,l.k6)((()=>[(0,l.bF)(_,{"auto-close":"",fit:""},{default:(0,l.k6)((()=>[(0,l.bF)(A,null,{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.sBridge.eosio,((o,t)=>((0,l.uX)(),(0,l.CE)(l.FK,{key:t},[e.sEosioChain&&e.sEosioChain.id!=o.id?(0,l.bo)(((0,l.uX)(),(0,l.Wv)(q,{key:0,clickable:"",onClick:o=>{var l;return e.selectChain(null===(l=e.sEosioChain)||void 0===l?void 0:l.type,t)}},{default:(0,l.k6)((()=>[(0,l.bF)(F,null,{default:(0,l.k6)((()=>[(0,l.bF)(S,null,{default:(0,l.k6)((()=>[(0,l.eW)((0,n.v_)(o.shortName),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])),[[R]]):(0,l.Q3)("",!0)],64)))),128))])),_:1})])),_:1})])),_:1},8,["label","icon-right"])]),(0,l.bF)(B,{class:"q-pt-md full-width",label:e.t("balance"),readonly:"",dense:"",amount:e.currentBalance.eosio,"onUpdate:amount":o[6]||(o[6]=o=>e.currentBalance.eosio=o),symbol:e.sSymbol,onRefresh:e.getEosioBalance,loading:e.balanceLoading.eosio},null,8,["label","amount","symbol","onRefresh","loading"])])),_:1})])),_:1}),(0,l.Lk)("div",{class:(0,n.C4)(["col-12 col-sm-2 col-md-4",e.$q.screen.lt.sm?"q-py-sm":"q-px-sm"])},[(0,l.bF)(q,{clickable:"",onClick:e.toggleDirection},{default:(0,l.k6)((()=>[(0,l.bF)(F,null,{default:(0,l.k6)((()=>[(0,l.Lk)("div",c,[(0,l.bF)(O,{name:e.$q.screen.gt.xs?"arrow_circle_right":"arrow_circle_down",size:e.$q.screen.gt.sm?"100px":"50px"},null,8,["name","size"]),(0,l.Lk)("div",d,(0,n.v_)(e.t("changeDirection")),1)])])),_:1})])),_:1},8,["onClick"])],2),(0,l.bF)(E,{class:"col-12 col-sm-5 col-md-4 column items-center bg-secondary rounded"},{default:(0,l.k6)((()=>[(0,l.bF)(k,{class:"full-width"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",v,[(0,l.bF)(T,{color:"secondary",label:e.sEthChain.shortName,"icon-right":e.sBridge.eth.length>1?"arrow_drop_down":""},{default:(0,l.k6)((()=>[(0,l.bF)(_,{"auto-close":"",fit:""},{default:(0,l.k6)((()=>[(0,l.bF)(A,null,{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.sBridge.eth,((o,t)=>((0,l.uX)(),(0,l.CE)(l.FK,{key:t},[e.sEthChain&&e.sEthChain.id!=o.id?(0,l.bo)(((0,l.uX)(),(0,l.Wv)(q,{key:0,clickable:"",onClick:o=>{var l;return e.selectChain(null===(l=e.sEthChain)||void 0===l?void 0:l.type,t)}},{default:(0,l.k6)((()=>[(0,l.bF)(F,null,{default:(0,l.k6)((()=>[(0,l.bF)(S,null,{default:(0,l.k6)((()=>[(0,l.eW)((0,n.v_)(o.shortName),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])),[[R]]):(0,l.Q3)("",!0)],64)))),128))])),_:1})])),_:1})])),_:1},8,["label","icon-right"]),(0,l.bF)(T,{round:"",icon:"add",onClick:e.addToken},null,8,["onClick"])]),(0,l.bF)(B,{class:"q-pt-md full-width",label:e.t("balance"),readonly:"",dense:"",amount:e.currentBalance.eth,"onUpdate:amount":o[7]||(o[7]=o=>e.currentBalance.eth=o),symbol:e.sSymbol,onRefresh:e.getEthBalance,loading:e.balanceLoading.eth},null,8,["label","amount","symbol","onRefresh","loading"])])),_:1})])),_:1})],2)):(0,l.Q3)("",!0),e.sBridge?((0,l.uX)(),(0,l.Wv)(E,{key:1,class:"q-mt-sm q-mb-md card"},{default:(0,l.k6)((()=>[(0,l.bF)(k,{top:"",class:"row q-py-sm"},{default:(0,l.k6)((()=>[o[11]||(o[11]=(0,l.Lk)("div",{class:"col"},"Transfer",-1)),(0,l.Lk)("div",null,[(0,l.bF)(T,{class:"colored-btn q-px-sm",dense:"",size:"10px",color:"red",label:"Max",onClick:e.selectMax},null,8,["onClick"])])])),_:1}),(0,l.bF)(k,{class:"q-pt-none"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",h,[(0,l.Lk)("div",m,[(0,l.bF)(B,{dense:"",amount:e.sendAmount,"onUpdate:amount":o[8]||(o[8]=o=>e.sendAmount=o),rules:e.sendRules,symbol:e.sSymbol,hint:e.feeHint},null,8,["amount","rules","symbol","hint"])]),(0,l.Lk)("div",f,[(0,l.bF)(T,{onClick:e.sendTeleport,flat:"",icon:"send",rounded:"",size:"xl"},null,8,["onClick"])])])])),_:1})])),_:1})):(0,l.Q3)("",!0),(0,l.bF)(E,{class:"q-my-sm card"},{default:(0,l.k6)((()=>[(0,l.bF)(k,{class:"row q-px-md q-my-none q-py-sm"},{default:(0,l.k6)((()=>[(0,l.bo)((0,l.bF)(x,{class:"col",modelValue:e.showFinished,"onUpdate:modelValue":o[9]||(o[9]=o=>e.showFinished=o),label:e.t("showFinished")},null,8,["modelValue","label"]),[[a.aG,e.teleports.length]]),(0,l.bo)((0,l.Lk)("div",g,[o[12]||(o[12]=(0,l.eW)(" Teleport is running ")),(0,l.bF)($,{class:"text-center",color:"primary",size:"4em"})],512),[[a.aG,e.loadingEosioTel||e.loadingEthTel]])])),_:1}),(0,l.bo)((0,l.bF)(H,{inset:""},null,512),[[a.aG,e.teleports.length]]),(0,l.bF)(k,{class:"q-my-none q-py-none"},{default:(0,l.k6)((()=>[e.sBridge?((0,l.uX)(),(0,l.Wv)(W,{key:0,bridge:e.sBridge,teleports:e.teleports,showFinished:e.showFinished,onClaimClick:e.claimClick},null,8,["bridge","teleports","showFinished","onClaimClick"])):(0,l.Q3)("",!0)])),_:1}),(0,l.bF)(k,{class:"q-my-none"},{default:(0,l.k6)((()=>[(0,l.bF)(T,{class:"full-width card-btn",onClick:o[10]||(o[10]=o=>e.get_last_Teleports()),label:e.t("getLastTeleports"),loading:e.loadTeleports},null,8,["label","loading"])])),_:1})])),_:1})],512),[[a.aG,e.ethConnected&&e.walletUser]])])),_:1})}var y=t(20989),b=t(87881),C=t(38734),k=t(60455),E=t(57387),T=t(74950),I=t(97588),w=t(43307),S=t(6885),F=t(99228),q=t(26790),A=t(72561),_=t(72092),B=t(82534),O=t(70308),x=t(43844),$=t(80302),H=t(39507),W=function(e,o,t,l){function n(e){return e instanceof t?e:new t((function(o){o(e)}))}return new(t||(t=Promise))((function(t,a){function i(e){try{u(l.next(e))}catch(o){a(o)}}function s(e){try{u(l["throw"](e))}catch(o){a(o)}}function u(e){e.done?t(e.value):n(e.value).then(i,s)}u((l=l.apply(e,o||[])).next())}))};const N=(0,l.pM)({name:"page-teleport",components:{TeleportList:I["default"],AssetField:w["default"],WalletEosio:S["default"],WalletEth:F["default"],BridgeSelect:q["default"]},setup(){const e=(0,H.V)(),o=(0,l.EW)((()=>e.allConnects)),t=(0,l.EW)((()=>e.walletUser)),n=(0,C.KR)({from:T.ChainType.EOSIO,to:T.ChainType.ETH}),a=(0,l.EW)({set:e=>{R(e)},get:()=>{if(p.value&&"number"==typeof p.value.metamaskId)return p.value.metamaskId}}),i=(0,E.s9)({useScope:"global"}).t.bind(this),s=(0,C.KR)({eth:BigInt(0),eosio:BigInt(0)}),u=(0,C.KR)({eth:!1,eosio:!1}),r=(0,C.KR)([T.bridgeSavAct,T.bridgeAlienWorld]),c=(0,C.KR)(),d=(0,l.EW)({set:t=>{var l;if(s.value={eosio:BigInt(0),eth:BigInt(0)},c.value=t,g.value&&(w.value=g.value.contract,(null===(l=e.selectedConnect)||void 0===l?void 0:l.chainParams.chainId)!=g.value.chainHash)){const t=(0,b.GetConnectByChainId)(g.value.chainHash,o.value);t&&e.setSelectedConnect(t)}f()},get:()=>c.value}),v=(0,C.KR)([]),h=(0,C.KR)(!0);function m(){if(g.value&&p.value){console.log("Set Path",g.value.shortName);const e="eosio",o=n.value.from===T.ChainType.ETH?"from":"to",t=`#${q.path}?bridge=${g.value.contract}&${e}=${g.value.shortName}&${o}=${p.value.shortName}`;history.replaceState(history.state,"",t)}else console.log("Set no Path"),history.replaceState(history.state,"",`#${q.path}`)}function f(){return W(this,void 0,void 0,(function*(){p.value&&d.value&&window.ethereum&&(null!=p.value.metamaskId&&a.value!=p.value.metamaskId&&(a.value=p.value.metamaskId),S.value=yield(0,A.getEthContract)(p.value.contract,window.ethereum,d.value.version)),m()}))}const g=(0,l.EW)((()=>{var e;return null===(e=c.value)||void 0===e?void 0:e.getSelectedByType(T.ChainType.EOSIO)})),p=(0,l.EW)((()=>{var e;return null===(e=c.value)||void 0===e?void 0:e.getSelectedByType(T.ChainType.ETH)})),I=(0,l.EW)((()=>{var e;return null===(e=g.value)||void 0===e?void 0:e.tokens[0].symbol})),w=(0,C.KR)(""),S=(0,C.KR)(),F=(0,C.KR)(void 0),q=(0,k.lq)(),N=q.query;if(console.log("Bridge Options",N),N&&N.bridge&&N.eosio){F.value=!0;for(let t of r.value){if(t.eosio[0].contract==N.bridge)if(N.eosio.length<64){if(t.eosio[0].shortName==N.eosio){d.value=t,F.value=!1;break}}else if(t.eosio[0].chainHash==N.eosio){d.value=t,F.value=!1;break}if(!0===F.value){const t=o.value.find((e=>e.chainParams.shortName==N.eosio||e.chainParams.chainId==N.eosio));t&&(w.value=N.bridge,e.setSelectedConnect(t))}}if(d.value){N.from?(n.value.from=T.ChainType.ETH,n.value.to=T.ChainType.EOSIO):(n.value.from=T.ChainType.EOSIO,n.value.to=T.ChainType.ETH);let e=N.eth?N.eth:N.from?N.from:N.to?N.to:void 0;if(void 0!=e){let o=-1;o="number"==typeof e?d.value.eth.findIndex((o=>o.metamaskId==e)):d.value.eth.findIndex((o=>o.shortName==e)),-1!=o&&(d.value.selected.eth=o,f())}}}function R(e){var o;if(d.value){if(e!=(null===(o=p.value)||void 0===o?void 0:o.metamaskId)){const o=d.value.eth.findIndex((o=>o.metamaskId==e));-1!=o?(d.value.selected.eth=o,m()):y.A.create({type:"negative",message:i("unavailableETHChain"),caption:i("unavailableETHChainDetail"),position:"top"})}re()}}const K=(0,C.KR)(0),L=(0,C.KR)(0),Q=(0,C.KR)(BigInt(0)),U=[e=>{if(void 0!=d.value&&I.value){let o=BigInt(0);if(n.value.from==T.ChainType.EOSIO){if(void 0==g.value||void 0==g.value.min)return!0;o=g.value.min}else{if(void 0==p.value||void 0==p.value.min)return!0;o=p.value.min}return o<=(0,O.StringToAmount)(e)||`${i("minIs")} ${(0,O.AmountToString)(o,I.value.precision)} ${I.value.name}`}return!0},()=>!D.value||i("someIsFreezed")],G=(0,l.EW)((()=>{var e;return(null===(e=d.value)||void 0===e?void 0:e.fee)?BigInt(Math.floor(Number(Q.value)*d.value.fee.var))+d.value.fee.fix:BigInt(0)})),M=(0,l.EW)((()=>{if(I.value&&G.value){const e=Q.value-G.value;return e>0?`${i("estimatedFeeOf")} ${(0,O.AssetToString)({amount:G.value,symbol:I.value})} ${i("resultsIn")} ${(0,O.AssetToString)({amount:e,symbol:I.value})}`:i("noAmountAfterTrans")}})),D=(0,l.EW)((()=>{var e;return!!(null===(e=d.value)||void 0===e?void 0:e.freeze)&&(d.value.freeze.in||d.value.freeze.out||d.value.freeze.oracles||d.value.freeze.cancel)}));function z(e){return v.value.find((o=>{if(o.id==e.id&&o.chain.from==e.chain.from&&o.chain.to==e.chain.to)return!0}))}function X(e){const o=z(e);if(o)o.confirmations=e.confirmations,o.oracles=e.oracles,o.quantity=e.quantity,o.signatures=e.signatures,o.confirmed=e.confirmed,o.canceled=e.canceled;else{const o=v.value.findIndex((o=>o.date<=e.date));-1!=o?v.value.splice(o,0,e):v.value.push(e),ee(e.id,j(e))}}function P(e,o,t,l,n){let a=!1;if(o==T.ChainType.EOSIO){const o=(0,A.ethPublicKeyToTableFormat)(t.to);v.value.find((l=>{var i;if(1==j(l)){if(l.date<e)return!0;if(l.asset.symbol.precision==t.asset.symbol.precision&&l.asset.symbol.name==t.asset.symbol.name&&l.asset.amount<=t.asset.amount&&l.from==t.from&&l.to==o&&(null===(i=l.chain.to)||void 0===i?void 0:i.id)==n)return a=!0,!0}}))}else v.value.find((o=>{var i;if(0==j(o)){if(o.date<e)return!0;if(o.asset.symbol.precision==t.asset.symbol.precision&&t.asset.symbol.name==t.asset.symbol.name&&o.asset.amount==t.asset.amount&&o.to==t.to&&(l<2||(null===(i=o.chain.to)||void 0===i?void 0:i.id)==n))return a=!0,!0}}));return a}function j(e){var o,t;return(null===(o=e.chain.from)||void 0===o?void 0:o.type)==T.ChainType.EOSIO||(null===(t=e.chain.to)||void 0===t?void 0:t.type)==T.ChainType.ETH}const V=(0,C.KR)({eosio:void 0,eth:void 0});function J(e,o){return W(this,void 0,void 0,(function*(){try{if(S.value&&te.value){if(!(e>=2))return yield S.value.claimed(String(o.id));if(o.chain.from)return yield S.value.isClaimed(String(o.chain.from.id),String(o.id))}}catch(t){console.log(t,"object"==typeof t&&"message"in t?t.message:""),y.A.create({type:"negative",message:i("errorOnRequestEth"),caption:String(t),position:"top"})}}))}function Y(e,l){var n,a;return W(this,void 0,void 0,(function*(){if(Z.value||!S.value||!t.value||!t.value.name)return void console.log(`loadTeleports ${String(Z.value)} || ethContract ${String(!S.value)} || walletUser ${String(!t.value)} || name ${String(!(null===(n=t.value)||void 0===n?void 0:n.name))}`);Z.value=!0;const i=t.value.name;if(console.log("Get last teleports"),d.value){const t=d.value,n=(0,b.GetConnectByChainId)(t.eosio[0].chainHash,o.value);if(n){const o=yield(0,A.getTeleports)(n,t,i,e,l);for(let e of o)X(e);for(let e of v.value)if(!e.confirmed&&!e.canceled){if((null===(a=e.chain.to)||void 0===a?void 0:a.type)==T.ChainType.ETH){const o=yield J(t.version,e);if(console.log("--------isClaimedOnETh",o),o){e.confirmed=!0,console.log("--------confirmed so continue",o);continue}}console.log("--------start updater"),(0,A.whileUpdateTeleport)(n,t,e)}}else y.A.create({type:"negative",message:"Unknown chain",caption:`Chain hash: ${t.eosio[0].chainHash}`,position:"top"})}console.log("Teleports",v.value),Z.value=!1}))}const Z=(0,C.KR)(!1);function ee(e,o){o?(void 0==V.value.eosio||e>V.value.eosio)&&(V.value.eosio=e):(void 0==V.value.eth||e>V.value.eth)&&(V.value.eth=e)}const oe=(0,C.KR)(),te=(0,C.KR)(!1);function le(e){console.log("Set eth account",e),oe.value=e}function ne(){return W(this,void 0,void 0,(function*(){if(d.value&&p.value&&!1!==!p.value.statusChecked&&S.value)if(d.value.version<=1){void 0==p.value.min&&(p.value.min=BigInt(0));try{p.value.neededConfirms=Number((yield S.value.threshold()).valueOf()),p.value.statusChecked=!0}catch(e){console.log("Can not get eth threshold",e)}}else try{p.value.min=BigInt((yield S.value.minteleport()).valueOf()),p.value.neededConfirms=Number((yield S.value.threshold()).valueOf()),p.value.statusChecked=!0}catch(e){console.log("Can not get eth status",e)}}))}function ae(){return W(this,void 0,void 0,(function*(){return!(!te.value||!p.value||null==p.value.metamaskId)&&(yield ne(),!!(yield(0,x.switchETHWalletNetwork)(p.value.metamaskId,!0))||(y.A.create({position:"top",type:"negative",message:i("noSwitchEthChain"),caption:i("noSwitchEthChainInfo")}),console.log("--switch sEthChain.value.metamaskId",p.value.metamaskId),console.log("--switch ethChainId.value",a.value),!1))}))}function ie(){return W(this,void 0,void 0,(function*(){p.value&&g.value&&(n.value.from===T.ChainType.EOSIO?yield se(p.value.id):n.value.from===T.ChainType.ETH&&(yield ue(g.value.id)),yield re(),yield ce())}))}function se(e){return W(this,void 0,void 0,(function*(){K.value++,yield(()=>W(this,void 0,void 0,(function*(){var l,n;if(!(0,B.checkEosioWalletAlerts)(t.value))return;const a=null===(l=t.value)||void 0===l?void 0:l.name;if(yield f(),!(yield ae())||!oe.value)return;if(!d.value)return;if(!I.value)return;console.log("EOSIO teleport");const s=d.value,u={from:a,to:oe.value,asset:{amount:Q.value,symbol:I.value}};console.log("ethAccount.value",oe.value);const r=(0,A.EosioTeleportTrx)(u,e,s.eosio[0],null===(n=t.value)||void 0===n?void 0:n.permission);if(!1===r)return!1;const c=y.A.create({type:"ongoing",message:i("signTrx"),position:"top"}),v={isError:!1,notify:c},h=yield b.Connect.trySigning(v,t.value,r,{broadcast:!1});if(!(0,_.trxSigningErrorHandling)(v,h,i))return!1;yield Y();let m=Math.floor(Date.now()/1e3);const g=(0,b.GetConnectByChainId)(s.eosio[0].chainHash,o.value);if(!g)return!1;if(!(yield(0,_.broadcastTrx)(v,g,h,i)))return!1;console.log("Wait for EOSIO teleport");let p=!1,C=0;do{yield(0,A.sleep)(C<5?2e3:3e4);let o=Math.floor(Date.now()/1e3);yield Y(A.GetTeleportType.eosio,{eosio:C<5?5:10}),p=P(m,T.ChainType.EOSIO,u,s.version,e),m=o,C++}while(!p);console.log("End waiting for EOSIO teleport")})))(),K.value--}))}function ue(e){return W(this,void 0,void 0,(function*(){L.value++,yield(()=>W(this,void 0,void 0,(function*(){if(!d.value||!p.value||"number"!=typeof p.value.metamaskId)return void console.log("No metamask id defined");if(!te.value||!oe.value)return void console.log("No eth account defined",te.value);if(yield f(),!(yield ae())||!S.value)return;if("bigint"!=typeof Q.value||Q.value==BigInt(0)||!I.value)return void console.log("Not valid asset");if(!t.value||!t.value.name)return void console.log("No EOSIO user diefined");if(!g.value)return void console.log("No eosio chain is selected");const l=d.value,n={from:oe.value,to:t.value.name,asset:{amount:Q.value,symbol:I.value}},a=(0,b.GetConnectByChainId)(l.eosio[0].chainHash,o.value);if(!a)return;if(!(yield a.checkAccountName(n.to))){const e=`The account ${n.to} seems not to exists on ${g.value.name} chain`;return console.log(e),void y.A.create({position:"top",type:"negative",message:e})}console.log("Eth teleport to chain id",e),yield Y();let i=Math.floor(Date.now()/1e3);console.log(`Teleport an amount of ${Q.value} ${n.from?"from "+n.from:""} to ${n.to}`);try{console.log(`teleport(${n.to}, ${Q.value.toString()}, ${g.value.id.toString()})`),yield S.value.teleport(n.to,Q.value.toString(),g.value.id.toString())}catch(u){return console.log("Eth wallet error",u),void fe(u)}y.A.create({position:"top",type:"positive",message:"Transaction send",caption:"Depending on the chain and gas fee, it may take some time until the tokens are transfered."}),console.log("Wait for eth teleport");let s=!1;do{yield(0,A.sleep)(1e4);let o=Math.floor(Date.now()/1e3);yield Y(A.GetTeleportType.eth,{eth:10}),s=P(i,T.ChainType.ETH,n,l.version,e),i=o}while(!s);console.log("End waiting for ETH teleport")})))(),L.value--}))}function re(){return W(this,void 0,void 0,(function*(){if(oe.value&&p.value&&!u.value.eth&&(yield f(),(yield ae())&&S.value)){u.value.eth=!0,s.value.eth=void 0;try{s.value.eth=yield S.value.balanceOf(oe.value),console.log("balanceOf typeof",s.value.eth)}catch(e){console.log("Error on getting eth balance",e)}finally{u.value.eth=!1}}}))}function ce(){return W(this,void 0,void 0,(function*(){if(!t.value||!t.value.name||!g.value)return;const e=(0,b.GetConnectByChainId)(g.value.chainHash,o.value);if(!e)return;if(u.value.eosio)return;u.value.eosio=!0,s.value.eosio=void 0;const l=g.value.tokens[0],n=yield e.get_currency_balance(l.contract,t.value.name,l.symbol.name);if(console.log(`Balances of ${t.value.name}`,n),n&&"length"in n&&n.length>0){const e=(0,O.StringToAsset)(n[0]);if(!e||e.symbol.name!=l.symbol.name||e.symbol.precision!=l.symbol.precision)return void console.log("Got wrong token");s.value.eosio=e.amount}u.value.eosio=!1}))}function de(){return W(this,void 0,void 0,(function*(){if(n.value&&s.value)switch(n.value.from){case T.ChainType.EOSIO:yield ce(),s.value.eosio&&(Q.value=s.value.eosio);break;case T.ChainType.ETH:yield re(),s.value.eth&&(Q.value=s.value.eth);break}}))}function ve(){console.log("Toogle direction");const e=n.value.from;n.value.from=n.value.to,n.value.to=e,m()}function he(e){te.value=e.value,e.value&&re()}function me(e){var t,l,n;return W(this,void 0,void 0,(function*(){if(oe.value)if(p.value&&d.value){if(yield f(),(yield ae())&&S.value)if(e.signatures){if((null===(t=e.chain.from)||void 0===t?void 0:t.type)==T.ChainType.EOSIO||(null===(l=e.chain.to)||void 0===l?void 0:l.type)==T.ChainType.ETH){if(!e.chain.to||null===(null===(n=e.chain.to)||void 0===n?void 0:n.metamaskId))return void console.log("Wrong or no metamask id");if(console.log("set to metamask id",e.chain.to.metamaskId),a.value=e.chain.to.metamaskId,!(yield ae()))return;try{const o=(0,A.teleportItemToSigData)(e.raw),t=d.value.version;let l,n;t>=2&&e.chain.from&&(l=e.chain.from.contract,n=(0,$.hexToUint8Array)(e.chain.from.chainHash.substring(0,8))),yield S.value.claim((0,A.createSigDataStr)({version:t,tel_contract:l,short_net_id:n},o),e.signatures)}catch(i){return void fe(i)}let t;if(!d.value)return;t=d.value,e.sendClaimed=!0,y.A.create({position:"top",type:"positive",message:"Transaction send",caption:"Depending on the chain and gas fee, it may take some time until the tokens are transfered."});let l=0;yield(0,A.sleep)(3e3);do{const o=yield J(t.version,e);if(o)return e.confirmed=!0,void(yield re());yield(0,A.sleep)(1e4)}while(l<6);if(!e.confirmed&&!e.canceled){const l=(0,b.GetConnectByChainId)(t.eosio[0].chainHash,o.value);l&&(e.update.lastAction=Math.floor(Date.now()/1e3),(0,A.whileUpdateTeleport)(l,t,e))}}}else console.log("No signatures available")}else console.log("No ethereum chain selected");else console.log("No ethereum account")}))}function fe(e){let o;console.log("Eth wallet error",e),"object"==typeof e&&"reason"in e&&(o=String(e.reason)),y.A.create({position:"top",type:"negative",message:"Wallet error while sending",caption:o})}function ge(e,o){d.value&&(e==T.ChainType.EOSIO?(d.value.selected.eosio=o,s.value.eosio=void 0):e==T.ChainType.ETH&&(d.value.selected.eth=o,s.value.eth=void 0),m())}function pe(){return W(this,void 0,void 0,(function*(){p.value&&(yield ae())&&(yield(0,x.addEthToken)(p.value.tokens[0]))}))}return{direction:n,toggleDirection:ve,loadingEosioTel:K,loadingEthTel:L,sendAmount:Q,sendRules:U,sSymbol:I,t:i,ethAccount:oe,ethChainId:a,bridges:r,sBridge:d,teleports:v,loadTeleports:Z,get_last_Teleports:Y,showFinished:h,sendTeleport:ie,setEthAccount:le,ethConnected:te,ethConnectChanged:he,sEosioChain:g,sEthChain:p,selectChain:ge,currentBalance:s,balanceLoading:u,selectMax:de,eosioContractModel:w,claimClick:me,getEthBalance:re,getEosioBalance:ce,customBridge:F,feeHint:M,walletUser:t,addToken:pe}}});var R=t(12807),K=t(77716),L=t(23316),Q=t(44189),U=t(56384),G=t(84436),M=t(53999),D=t(90124),z=t(25173),X=t(13796),P=t(50492),j=t(66908),V=t(56241),J=t(10386),Y=t(88672),Z=t(98582),ee=t.n(Z);const oe=(0,R.A)(N,[["render",p]]),te=oe;ee()(N,"components",{QPage:K.A,QCard:L.A,QCardSection:Q.A,QBtn:U.A,QMenu:G.A,QList:M.A,QItem:D.A,QItemSection:z.A,QItemLabel:X.A,QIcon:P.A,QToggle:j.A,QSpinnerBox:V.A,QSeparator:J.A}),ee()(N,"directives",{ClosePopup:Y.A})}}]);