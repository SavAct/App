"use strict";(globalThis["webpackChunksavactapp"]=globalThis["webpackChunksavactapp"]||[]).push([[217],{89811:(e,t,o)=>{o.r(t),o.d(t,{default:()=>Pe});var a=o(59835),l=o(86970),n=o(61957);const i={class:"col q-mt-sm q-px-md"},s={class:"col-auto"},r={class:"row"},c={class:"full-width row"},u={class:"col wrap"},d={class:"col-auto"},m={class:"col-12 text-h6 text-left"},v={class:"col-12 text-left"},p=(0,a._)("span",{class:"q-pl-md q-pr-xs"},"Memo",-1),y={class:"row"},g={class:"col-auto q-pl-md"},f={class:"col-grow"},h={class:"q-pl-md q-pr-xs"},w={class:"row"},b={class:"col"},V={key:0,class:"row"},x={key:1},k={class:"text-no-wrap"},T={key:0},P=(0,a._)("span",null,":  ",-1),q={key:2,class:"full-width"},_={class:"col-auto"},S={class:"q-px-md q-mb-md"},C={class:"q-mt-sm cardMaxWidth"},W={class:"col q-py-md q-px-sm text-subtitle2"},D={class:"col q-py-md q-px-sm text-subtitle2"},M={class:"q-my-md"},A=["href"],U={class:"col q-py-md q-px-sm text-subtitle2"};function O(e,t,o,O,N,F){const E=(0,a.up)("q-btn"),I=(0,a.up)("q-card-section"),Z=(0,a.up)("q-card"),H=(0,a.up)("key-or-name-input"),z=(0,a.up)("q-chip"),$=(0,a.up)("q-input"),j=(0,a.up)("q-icon"),K=(0,a.up)("q-toggle"),B=(0,a.up)("remaining-time"),Q=(0,a.up)("date-time-input"),G=(0,a.up)("time-view"),L=(0,a.up)("transfer-data-view"),R=(0,a.up)("wallet-eosio"),J=(0,a.up)("q-dialog"),X=(0,a.up)("symbol-dialog"),Y=(0,a.up)("vote-dialog"),ee=(0,a.up)("q-page"),te=(0,a.Q2)("close-popup");return(0,a.wg)(),(0,a.j4)(ee,{class:"column",style:{height:"100%"}},{default:(0,a.w5)((()=>[(0,a._)("div",i,[(0,a.Wm)(Z,{class:"q-my-sm card cardMaxWidth"},{default:(0,a.w5)((()=>[(0,a.Wm)(I,{class:"row items-center justify-left"},{default:(0,a.w5)((()=>{var t;return[(0,a._)("div",s,(0,l.zw)(e.t("payOnThe")),1),(0,a.Wm)(E,{class:"col-auto q-ml-sm",dense:"",label:`${null===(t=e.chain)||void 0===t?void 0:t.name} Network`,onClick:e.showWalletDialog},null,8,["label","onClick"])]})),_:1})])),_:1}),(0,a.Wm)(Z,{class:"q-my-sm card cardMaxWidth"},{default:(0,a.w5)((()=>[(0,a.Wm)(I,null,{default:(0,a.w5)((()=>[e.showSender?((0,a.wg)(),(0,a.j4)(H,{key:0,modelValue:e.sender,"onUpdate:modelValue":t[0]||(t[0]=t=>e.sender=t),outlined:"",label:e.t("sender"),walletOption:"",pubkeyOption:"",class:"q-mb-md",useAvailableWallet:""},null,8,["modelValue","label"])):(0,a.kq)("",!0),(0,a.Wm)(H,{dense:"",modelValue:e.recipient,"onUpdate:modelValue":t[1]||(t[1]=t=>e.recipient=t),outlined:"",label:e.t("recipient")},null,8,["modelValue","label"])])),_:1})])),_:1}),(0,a.Wm)(Z,{class:"q-my-sm card cardMaxWidth"},{default:(0,a.w5)((()=>[(0,a.Wm)(I,null,{default:(0,a.w5)((()=>[(0,a._)("div",r,[e.isVote?((0,a.wg)(),(0,a.j4)(z,{key:0,class:"q-mb-md col-grow",color:"number"==typeof e.selVote?"blue":"red","text-color":"white",icon:"poll",clickable:"",onClick:t[3]||(t[3]=t=>e.showVoteDialog=!0),square:""},{default:(0,a.w5)((()=>[(0,a._)("div",c,[(0,a._)("div",u,(0,l.zw)("number"==typeof e.selVote?`${e.selVote+1}. ${e.shrinkText(e.voteOptions[e.selVote],e.Screen.width/20)}`:e.t("selectVote")),1),(0,a._)("div",d,[(0,a.Wm)(E,{round:"",class:"text-white",size:"xs",icon:"done",dense:"",style:(0,l.j5)(`background-color:${"number"==typeof e.selVote?e.VoteColor[e.selVote]:"white"}`),onClick:t[2]||(t[2]=t=>e.showVoteDialog=!0)},null,8,["style"])])])])),_:1},8,["color"])):(0,a.kq)("",!0)]),(0,a.Wm)($,{outlined:"","bottom-slots":"",modelValue:e.amount,"onUpdate:modelValue":t[5]||(t[5]=t=>e.amount=t),type:"number",label:e.t("amount"),class:"full-width","hide-bottom-space":""},{append:(0,a.w5)((()=>[(0,a.Wm)(E,{size:"sm",class:"row q-px-sm q-py-none q-ma-none",onClick:t[4]||(t[4]=t=>e.showSymbol=!0)},{default:(0,a.w5)((()=>[(0,a._)("div",m,(0,l.zw)(e.symbol),1),(0,a._)("div",v,(0,l.zw)(e.tokenContract),1)])),_:1})])),_:1},8,["modelValue","label"]),e.isVote?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("div",{key:0,class:"q-mt-md",onClick:t[7]||(t[7]=t=>e.extraMemo.active=!e.extraMemo.active)},[(0,a.Wm)(j,{name:"notes",size:"sm",color:e.extraMemo.active?"blue":""},null,8,["color"]),p,(0,a.Wm)(K,{modelValue:e.extraMemo.active,"onUpdate:modelValue":t[6]||(t[6]=t=>e.extraMemo.active=t),size:"md","unchecked-icon":"clear","checked-icon":"check"},null,8,["modelValue"])])),(0,a._)("div",y,[(0,a.wy)((0,a.Wm)($,{class:"col full-width",dense:"",outlined:"","bottom-slots":"",modelValue:e.extraMemo.value,"onUpdate:modelValue":t[9]||(t[9]=t=>e.extraMemo.value=t),label:"Memo",maxlength:"255","hide-bottom-space":""},{append:(0,a.w5)((()=>[""!==e.extraMemo.value?((0,a.wg)(),(0,a.j4)(j,{key:0,name:"close",onClick:t[8]||(t[8]=t=>e.extraMemo.value=""),class:"cursor-pointer"})):(0,a.kq)("",!0)])),_:1},8,["modelValue"]),[[n.F8,e.extraMemo.active]]),(0,a.wy)((0,a._)("div",g,[(0,a.Wm)(j,{class:"cursor-pointer",name:"info",onClick:t[10]||(t[10]=t=>e.showMemoExplainDialog=!0),round:"",size:"xs",dense:""})],512),[[n.F8,e.extraMemo.active]])])])),_:1})])),_:1}),e.savPayAvailable?((0,a.wg)(),(0,a.j4)(Z,{key:0,class:"q-my-sm card cardMaxWidth"},{default:(0,a.w5)((()=>[(0,a.Wm)(I,{class:"row"},{default:(0,a.w5)((()=>[(0,a._)("div",f,[e.isVote?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("div",{key:0,onClick:t[12]||(t[12]=t=>e.savPay=!e.savPay)},[(0,a.Wm)(j,{name:"health_and_safety",size:"sm",color:e.savPay?"blue":""},null,8,["color"]),(0,a._)("span",h,(0,l.zw)(e.t("useSavAct")),1),(0,a.Wm)(K,{modelValue:e.savPay,"onUpdate:modelValue":t[11]||(t[11]=t=>e.savPay=t),size:"md","unchecked-icon":"clear","checked-icon":"check",disable:e.isVote},null,8,["modelValue","disable"])])),(0,a.wy)((0,a._)("div",w,[(0,a._)("div",b,[e.isVote?((0,a.wg)(),(0,a.iD)("div",V,[(0,a._)("span",{class:"text-no-wrap col-sm-auto col-12 cursor-pointer",onClick:t[13]||(t[13]=t=>e.showDateDialog=!0)},[(0,a.Uk)((0,l.zw)(e.t("voteEndTime"))+" ",1),(0,a.Wm)(j,{class:"",name:"more"}),(0,a.Uk)("  ")]),(0,a.Wm)(B,{class:"text-no-wrap col-sm-auto col-12",modelValue:e.voteEnd,"onUpdate:modelValue":t[14]||(t[14]=t=>e.voteEnd=t),timeOverMsg:e.t("timeIsOver")},null,8,["modelValue","timeOverMsg"])])):((0,a.wg)(),(0,a.iD)("div",x,[(0,a._)("span",k,(0,l.zw)(e.isVote?e.t("voteTime"):e.t("timelimit")),1),void 0!==e.limit?((0,a.wg)(),(0,a.iD)("span",T,[P,(0,a.Wm)(B,{modelValue:e.limit,"onUpdate:modelValue":t[15]||(t[15]=t=>e.limit=t),timeOverMsg:e.t("timeIsOver")},null,8,["modelValue","timeOverMsg"])])):(0,a.kq)("",!0),(0,a.Wm)(Q,{disable:e.isVote,modelValue:e.limit,"onUpdate:modelValue":t[16]||(t[16]=t=>e.limit=t)},null,8,["disable","modelValue"])])),e.isVote?((0,a.wg)(),(0,a.iD)("div",q,[(0,a._)("span",null,(0,l.zw)(e.t("punishTimeSpanSend"))+":  ",1),(0,a.Wm)(G,{class:"col",showTime:e.decisionTime,minTime:3600,belowMinMsg:e.t("minPunishTime"),valueClasses:"text-green"},null,8,["showTime","belowMinMsg"])])):(0,a.kq)("",!0)]),(0,a._)("div",_,[(0,a.Wm)(j,{class:"cursor-pointer",name:"info",onClick:t[17]||(t[17]=t=>e.showSavActExplainDialog=!0),round:"",size:"xs",dense:""})])],512),[[n.F8,e.savPay]])])])),_:1})])),_:1})):(0,a.kq)("",!0)]),(0,a._)("div",S,[(0,a._)("div",C,[e.inputsValid?((0,a.wg)(),(0,a.j4)(L,{key:0,sender:e.sender,recipient:e.to,quantity:e.quantity,memo:e.memo,memoActive:e.extraMemo.active||e.savPay,tokenContract:e.tokenContract},null,8,["sender","recipient","quantity","memo","memoActive","tokenContract"])):(0,a.kq)("",!0)]),(0,a.Wm)(Z,{class:"q-mt-sm card cardMaxWidth"},{default:(0,a.w5)((()=>[(0,a.Wm)(I,{class:"row justify-between"},{default:(0,a.w5)((()=>[(0,a.Wm)(R,{class:"col q-pr-md"}),e.walletStyle?((0,a.wg)(),(0,a.j4)(E,{key:0,class:"col-12 col-sm-auto q-mt-md",label:"Send","icon-right":"send",color:"blue",onClick:e.confirm,disable:e.loadingConfirm},null,8,["onClick","disable"])):e.inputsValid?((0,a.wg)(),(0,a.j4)(E,{key:1,class:"col-12 q-mt-sm",size:"sm","no-caps":"",dense:"",label:e.t("alreadyPayed"),onClick:e.alreadyPayed},null,8,["label","onClick"])):(0,a.kq)("",!0)])),_:1})])),_:1})]),(0,a.Wm)(J,{modelValue:e.showMemoExplainDialog,"onUpdate:modelValue":t[18]||(t[18]=t=>e.showMemoExplainDialog=t)},{default:(0,a.w5)((()=>[(0,a.Wm)(Z,{bordered:""},{default:(0,a.w5)((()=>[(0,a.Wm)(I,{class:"row q-ma-none q-pa-none"},{default:(0,a.w5)((()=>[(0,a.wy)((0,a.Wm)(E,{class:"col-1 q-mt-none q-pa-none",dense:"",flat:"",icon:"arrow_back_ios_new"},null,512),[[te]]),(0,a._)("div",W,(0,l.zw)(e.t("isMemoKnown")),1)])),_:1}),(0,a.Wm)(I,{class:"q-pt-none"},{default:(0,a.w5)((()=>[(0,a._)("div",null,(0,l.zw)(e.t("memoDescr")),1)])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,a.Wm)(J,{modelValue:e.showSavActExplainDialog,"onUpdate:modelValue":t[19]||(t[19]=t=>e.showSavActExplainDialog=t)},{default:(0,a.w5)((()=>[(0,a.Wm)(Z,{bordered:""},{default:(0,a.w5)((()=>[(0,a.Wm)(I,{class:"row q-ma-none q-pa-none"},{default:(0,a.w5)((()=>[(0,a.wy)((0,a.Wm)(E,{class:"col-1 q-mt-none q-pa-none",dense:"",flat:"",icon:"arrow_back_ios_new"},null,512),[[te]]),(0,a._)("div",D,(0,l.zw)(e.t("isSavActKnown")),1)])),_:1}),(0,a.Wm)(I,{class:"q-pt-none"},{default:(0,a.w5)((()=>[(0,a._)("div",null,(0,l.zw)(e.t("timeLimitDescr")),1),(0,a._)("div",M,(0,l.zw)(e.t("recipientKnowsSavAct")),1),(0,a._)("div",null,[(0,a.Uk)((0,l.zw)(e.t("paymentWpHint"))+" ",1),(0,a._)("a",{href:e.t("wpLink"),target:"_blank"},(0,l.zw)(e.t("wpFileClickName")),9,A)])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,a.Wm)(J,{modelValue:e.showDateDialog,"onUpdate:modelValue":t[21]||(t[21]=t=>e.showDateDialog=t)},{default:(0,a.w5)((()=>[(0,a.Wm)(Z,{bordered:""},{default:(0,a.w5)((()=>[(0,a.Wm)(I,{class:"row q-ma-none q-pa-none"},{default:(0,a.w5)((()=>[(0,a.wy)((0,a.Wm)(E,{class:"col-1 q-mt-none q-pa-none",dense:"",flat:"",icon:"arrow_back_ios_new"},null,512),[[te]]),(0,a._)("div",U,(0,l.zw)(e.t("voteEndTime")),1)])),_:1}),(0,a.Wm)(I,{class:(0,l.C_)(["row q-mt-none q-pt-none q-mb-md",e.$q.screen.lt.sm?"q-mx-none":"q-mx-md "])},{default:(0,a.w5)((()=>{var o;return[(0,a.Wm)(B,{class:"text-no-wrap col-sm-auto col-12",modelValue:e.voteEnd,"onUpdate:modelValue":t[20]||(t[20]=t=>e.voteEnd=t),timeOverMsg:e.t("timeIsOver")},null,8,["modelValue","timeOverMsg"]),(0,a._)("div",null,(0,l.zw)(null===(o=e.voteEnd)||void 0===o?void 0:o.toString()),1)]})),_:1},8,["class"])])),_:1})])),_:1},8,["modelValue"]),(0,a.Wm)(X,{modelValue:e.showSymbol,"onUpdate:modelValue":t[22]||(t[22]=t=>e.showSymbol=t),contract:e.tokenContract,"onUpdate:contract":t[23]||(t[23]=t=>e.tokenContract=t),symbol:e.symbol,"onUpdate:symbol":t[24]||(t[24]=t=>e.symbol=t),connect:e.connect,precision:e.fixed,"onUpdate:precision":t[25]||(t[25]=t=>e.fixed=t)},null,8,["modelValue","contract","symbol","connect","precision"]),(0,a.Wm)(Y,{modelValue:e.showVoteDialog,"onUpdate:modelValue":t[26]||(t[26]=t=>e.showVoteDialog=t),selected:e.selVote,"onUpdate:selected":t[27]||(t[27]=t=>e.selVote=t),options:e.voteOptions,title:e.voteTitle},null,8,["modelValue","selected","options","title"])])),_:1})}var N=o(48716),F=o(54228),E=o(22710),I=o(66098),Z=o(4135),H=o(66832),z=o(23616),$=o(72972),j=o(6827),K=o(38346),B=o(5980),Q=o(60499),G=o(3390),L=o(28339),R=o(76647),J=o(62659),X=o(94345),Y=o(72354),ee=o(7580),te=o(53103),oe=o(74544),ae=o(39882),le=o.n(ae),ne=o(86350),ie=o(47983),se=o(17779),re=o(40270)["Buffer"],ce=function(e,t,o,a){function l(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,n){function i(e){try{r(a.next(e))}catch(t){n(t)}}function s(e){try{r(a["throw"](e))}catch(t){n(t)}}function r(e){e.done?o(e.value):l(e.value).then(i,s)}r((a=a.apply(e,t||[])).next())}))};const ue=(0,a.aZ)({name:"page-send",components:{WalletEosio:N["default"],TransferDataView:F["default"],KeyOrNameInput:E["default"],DateTimeInput:I["default"],RemainingTime:Z["default"],SymbolDialog:H["default"],VoteDialog:z["default"],TimeView:$["default"]},setup(){var e,t,o,l,n,i;const s=(0,a.FN)(),r=(0,R.QT)({useScope:"global"}).t.bind(this),c=(0,J.r)(),u=(0,G.b)(),d=(0,L.yj)(),m=(0,L.tv)(),v=(0,Q.iH)(!1);let p=!1;const y=(0,a.Fl)((()=>u.brightStyle)),g=(0,a.Fl)((()=>c.walletUser)),f=(0,a.Fl)((()=>c.walletUsers)),h=(0,a.Fl)((()=>c.getWalletStyle)),w=(0,Q.iH)(!1),b=(0,a.Fl)({set:e=>{if(e){if(!$())return}else if(ve.value.length>13||ye.value.length>13)return void j.Z.create({type:"negative",message:r("keyUseSavPay"),position:"top"});w.value=e},get:()=>w.value}),V=(0,Q.iH)(new Date(Date.now()+864e5+6e5)),x=(0,a.Fl)((()=>V.value?V.value.getTime()/1e3:-1)),k=(0,a.Fl)((()=>{if(0==ye.value.length)return se.log("No recipient"),!1;if((ve.value.length>13||ye.value.length>13)&&!b.value)return se.log("SavPay has to be activated on payments from or to a key"),!1;if(he.value<0)return se.log("No amount"),!1;if(b.value){if(!$())return se.log("SavPay is not available"),!1;if(0==ve.value.length)return se.log("No sender"),!1;if(!V.value||V.value.getTime()<Date.now())return se.log("Time limit is already over"),!1}return W&&"number"!=typeof A.value?(se.log("No vote option selected"),!1):(se.log("Every input is valid"),!0)})),T=(0,a.Fl)((()=>b.value?c.selectedConnect&&c.selectedConnect.chainParams.savpayContract?c.selectedConnect.chainParams.savpayContract:"":ye.value)),P=d.query;se.log("payment Options",P),void 0!==P.requestId&&u.updateBrowserPayment(P.requestId,!0,!1);let q=void 0!=P.from?P.from:"";0==q.length&&void 0!=g.value&&void 0!=g.value.name?q=g.value.name:q.length>13&&(q.startsWith("EOS")||q.startsWith("PUP"))&&(b.value=!0);const _=(0,Q.iH)(!1),S=(0,Q.iH)(!1),C=(0,Q.iH)(!1);let W=!!P.V&&"string"==typeof P.V;const D=(0,Q.iH)(!1);let M=[];const A=(0,Q.iH)();let U,O,N,F,E,I;if(W&&P.V){const e=le().decode(P.V);let t;if(se.log("Vote data",e),U=e[0],O=e[1],E=e[2],N=new DataView(e.slice(3,7).reverse().buffer).getUint32(0),U==J.P.PublicVote)try{F=new DataView(e.slice(7,15).reverse().buffer).getBigUint64(0),se.log("Public vote index",F),t=e.slice(15)}catch(Fe){se.log("Error parsing public vote index",Fe),W=!1}else se.log("Private vote"),t=e.slice(7);t&&(se.log("optionsArray",t),M=(0,ne.OneStringToStringArray)((new TextDecoder).decode(t)),I=E+1==M.length?M.pop():""),E!=M.length?(W=!1,se.log(`Wrong amount voteId ${O} choisesAmount`,E,"!=",M.length)):D.value=!0,U!=J.P.PrivateVote&&U!=J.P.PublicVote&&se.log("Unknown vote type:",U),se.log("Vote parameters",{isVote:W,voteType:U,voteId:O,choisesAmount:E,voteEndTime:N,publicVoteIndex:F,voteOptions:M,voteTitle:I})}const Z=(0,a.Fl)((()=>V.value?new Date(1e3*N):void 0)),H=(0,a.Fl)((()=>V.value&&Z.value?(V.value.getTime()-Z.value.getTime())/1e3:void 0)),z=(0,a.Fl)((()=>b.value||void 0==P.to||q.length>0));function $(){return!1!==ae()||(j.Z.create({type:"negative",message:r("errSavPayNotAvailable"),position:"top"}),w.value=!1,!1)}function ae(){if(c.selectedConnect&&c.selectedConnect.chainParams)return!!c.selectedConnect.chainParams.savpayContract}const ue=(0,a.Fl)((()=>{var e;return null===(e=c.selectedConnect)||void 0===e?void 0:e.chainParams}));(0,B.iniSelectedChain)(P.chain,void 0==ue.value?De:void 0);const de=(0,Q.iH)(void 0!=P.from?"wallet":"third"),me=(0,Q.iH)(q),ve=(0,a.Fl)({get:()=>me.value,set:e=>{e.length>13&&(b.value=!0),me.value=e}}),pe=(0,Q.iH)(void 0!=P.to?P.to:""),ye=(0,a.Fl)({get:()=>pe.value,set:e=>{e.length>13&&(b.value=!0),pe.value=e}}),ge=(0,Q.iH)(!1);ye.value.length>13&&(ye.value.startsWith("EOS")||ye.value.startsWith("PUP"))&&(b.value=!0);const fe=(0,Q.iH)((null===(t=null===(e=c.selectedConnect)||void 0===e?void 0:e.chainParams.systemToken)||void 0===t?void 0:t.contract)?c.selectedConnect.chainParams.systemToken.contract:"eosio.token"),he=(0,Q.iH)(0),we=(0,Q.iH)((null===(l=null===(o=c.selectedConnect)||void 0===o?void 0:o.chainParams.systemToken)||void 0===l?void 0:l.symbol)?c.selectedConnect.chainParams.systemToken.symbol:"EOS"),be=(0,Q.iH)((null===(i=null===(n=c.selectedConnect)||void 0===n?void 0:n.chainParams.systemToken)||void 0===i?void 0:i.precision)?c.selectedConnect.chainParams.systemToken.precision:4),Ve=(0,a.Fl)({set:e=>{if(0==e.trim().length)return;let t=e.indexOf(".")+1,o=e.indexOf(" ",t);if(-1==o)for(let l=t;l<e.length;++l)if(-1=="0123456789".indexOf(e[l])){e=e.slice(0,l)+" "+e.slice(l),o=l;break}let a=o-t;be.value=t>-1&&a>=0?a:0,-1==o||o>=e.length||(he.value=parseFloat(e.substring(0,o)),we.value=e.substring(o+1))},get:()=>{const e=parseFloat(he.value.toString());if(e>=0&&!isNaN(e)){const t=e.toFixed(be.value);return`${t} ${we.value}`}return""}});if("string"==typeof P.pay){const e=P.pay.split(" ");e.length>3||e.length<2?se.log('Got invalid asset by query parameter "pay"'):(3==e.length&&((0,X.isNameValid)(e[3])?se.log('Got invalid token contract by query parameter "pay"'):fe.value=e[2]),Ve.value=`${e[0]} ${e[1]}`)}let xe="";void 0!=P.M?xe=(new TextDecoder).decode(le().decode(P.M)).toString():void 0!=P.MEMO?xe=re.from(P.MEMO,"base64").toString():void 0!=P.m?xe=P.m:void 0!=P.memo&&(xe=P.memo);const ke=(0,Q.iH)({active:""!=xe,value:xe});function Te(){if(V.value){let e;return e=ke.value.active&&ke.value.value.length>0?`;${ke.value.value}`:W&&"number"==typeof A.value?":"+(0,ne.createVoteMemo)(O,M.length,A.value,N,F,ke.value.value.length>0?(new TextEncoder).encode(ke.value.value):void 0):"",`${ve.value}@${ye.value}!${(0,ee.base58Time)(x.value)}${e}`}return""}const Pe=(0,a.Fl)((()=>b.value?Te():ke.value.active?ke.value.value:"")),qe=(0,a.Fl)((()=>c.selectedConnect));if(void 0!=P.t||void 0!=P.dt||void 0!=P.T||void 0!=P.DT){let e;void 0!=P.t||void 0!=P.dt?e=void 0!=P.t?P.t:P.dt:(e=void 0!=P.T?P.T:P.DT,e=(0,ee.base58TimeToNumber)(e));let t=1e3*("number"==typeof e?e:Number.parseInt(e));isNaN(t)||(void 0==P.t&&void 0==P.T&&(t=Date.now()+t),V.value=new Date(t),b.value=!0)}function _e(){var e,t,o;return ce(this,void 0,void 0,(function*(){if(!0===ge.value)return;ge.value=!0,null===(e=null===s||void 0===s?void 0:s.proxy)||void 0===e||e.$forceUpdate();const a=c.selectedConnect;if(!a)return void(ge.value=!1);if(b.value&&!$())return void(ge.value=!1);const l=b.value;if(0==he.value)return se.log("Amount can not be 0"),j.Z.create({type:"negative",message:r("errNoZeroAmount"),position:"top"}),void(ge.value=!1);ve.value=ve.value.trim(),ye.value=ye.value.trim();const n=null===(t=(0,X.StringToAsset)(Ve.value))||void 0===t?void 0:t.amount;if("undefined"==typeof n)return void(ge.value=!1);const i={sender:ve.value,recipient:ye.value,quantity:Ve.value,amount:n,tokenContract:fe.value,time:V.value?x.value:-1,memo:Pe.value};if(void 0==g.value)return j.Z.create({message:r("errSelectWallet"),position:"top"}),Me(),void(ge.value=!1);if((yield g.value.getChainId())!=(null===(o=ue.value)||void 0===o?void 0:o.chainId))return j.Z.create({message:r("errWrongWalletChain"),position:"top"}),void(ge.value=!1);if(!k.value)return j.Z.create({type:"negative",message:r("notAllValid"),position:"top"}),void(ge.value=!1);if(!1===(yield Oe()))return void(ge.value=!1);let u=!1;if(void 0!=g.value.name&&g.value.name.length>0){if(!l&&i.sender&&(0,X.isNameValid)(i.sender)&&g.value.name!=i.sender)return j.Z.create({message:r("errWrongWalletUser"),position:"top"}),void(ge.value=!1);let e=i.sender==g.value.name?Pe.value.substring(Pe.value.indexOf("@")):Pe.value;const t=j.Z.create({type:"ongoing",message:r("signTrx"),position:"top"}),o={isError:!1,notify:t};let n=yield B.Connect.sendCustomAsset(o,g.value,{from:g.value.name,to:T.value,quantity:i.quantity,memo:e},i.tokenContract,!1,g.value.permission);if((0,Y.trxSigningErrorHandling)(o,n,r)&&a){const e=l?yield Se(a,i.recipient):"-1";if(se.log("Got NextId",e),yield(0,Y.broadcastTrx)(o,a,n,r)){let t;if(l){let l=!1;if(i.memo.length>0){const e=i.memo.indexOf(";"),t=i.memo.indexOf(":");let o;-1==t||-1!=e&&e<t?o=e:(o=t,l=!0),i.memo=o>0?i.memo.substring(o+1):""}const n=Date.now();se.log("loadSavPayTrx with NextId",e);const s=yield We(a,e,i,l);s?(se.log(r("savPayFound")),Date.now()-n<5e3&&o.notify?o.notify({type:"positive",message:r("savPayFound")}):j.Z.create({type:"positive",message:r("savPayFound"),position:"top"}),t=String(s.id),u=!0):(se.log(r("savPayTrxNotFound")),j.Z.create({type:"negative",message:r("savPayTrxNotFound"),position:"top"}))}else u=!0;ge.value=!1,!0===u?(p={to:i.recipient,from:i.sender.length>0?i.sender:void 0,t:-1==i.time?void 0:i.time,memo:i.memo,pay:`${i.quantity} ${i.tokenContract}`,chain:a.chainParams.shortName?a.chainParams.shortName:a.chainParams.chainId,index:t},De()):(p=!1,De())}}}else j.Z.create({message:r("errSetUserOfWallet"),position:"top"});ge.value=!1}))}function Se(e,t){return ce(this,void 0,void 0,(function*(){let o,a;if((0,X.isNameValid)(t))o=String((0,ee.nameToUint64)(t)),a="name";else{const e=te.PublicKey.fromString(t);o=String((0,ee.splitPubKeyToScopeAndTableVec)(e).scope),a="key"}se.log("Get get NextId with",{code:e.chainParams.savpayContract,table:"data",scope:a,lower_bound:o,upper_bound:o});const l=yield e.get_table_rows({code:e.chainParams.savpayContract,table:"data",scope:a,lower_bound:o,upper_bound:o});if(se.log("result get NextId",l),l&&"rows"in l&&l.rows.length>0){const e=l.rows[0];return String(e.nextId)}return se.log("Use String 0 for Nextid",String(0)),String(0)}))}function Ce(e,t){if(typeof e!=typeof t||e.length!=t.length)return!1;if("string"==typeof e&&"string"==typeof t)return e.valueOf()===t.valueOf();for(let o=0;o<e.length;o++)if(e[o]!=t[o])return!1;return!0}function We(e,t,o,a=!1){var l;return ce(this,void 0,void 0,(function*(){let n=t;se.log("loadSavPayTrx with",{beginId:t,should:o,isVote:a});let i,s,r=0;if((0,X.isNameValid)(o.sender))i=(0,ee.nameToFromHex)(o.sender);else{const e=te.PublicKey.fromString(o.sender);o.sender=e.toString(),i=(0,ee.hexWithTypeOfPubKey)(e)}if(a)try{s=(0,ne.Uint8ArrayToString)(le().decode(o.memo).slice(1))}catch(Fe){se.log("No base58 memo on vote"),s=o.memo}else{const e=(0,ne.StringToUint8Array)(o.memo,"utf-8");if(void 0===e)return se.log("Cannot convert Memo to Uint8Array"),!1;s=(0,ne.Uint8ArrayToString)(e)}const u=null===(l=(0,X.StringToAsset)(o.quantity))||void 0===l?void 0:l.symbol;if(void 0==u)return se.log("No symbol defined"),!1;try{if((0,X.isNameValid)(o.recipient))while(1){const t=yield e.get_table_rows({code:e.chainParams.savpayContract,table:"pay2name",scope:o.recipient,lower_bound:n,json:!1,limit:200});if(t&&"rows"in t&&t.rows.length>0){for(const l of t.rows){const t=(0,ne.rawSavActPaymentToObject)(l,ne.SavActPayTableType.pay2name);if(void 0!==t&&(t.from==i&&t.orisent==o.amount&&t.time==o.time&&Ce(t.memo,s)&&t.fund.symbol.precision==u.precision&&t.fund.symbol.name==u.name)){const a=t.fund.symbol,l={sender:o.sender,recipient:o.recipient,id:Number(t.id),fund:(0,X.AssetToString)(t.fund),orifund:(0,X.AssetToString)({amount:t.orisent,symbol:a}),memo:s,ramBy:t.ramBy,type:t.type,time:t.time,contract:t.contract,lastUpdate:Date.now(),removed:!1,chain:e.chainParams.shortName?e.chainParams.shortName:e.chainParams.chainId};return c.updateHistoryInTrx(o.recipient,l),c.updateHistoryOutTrx(o.sender,l),l}}const a=(0,ne.rawSavActPaymentToObject)(t.rows[t.rows.length-1],ne.SavActPayTableType.pay2name);a&&(n=String(a.id++))}if(!(r<21))return!1;yield(0,oe.sleep)(r<4?500:r<10?1e3:2e3),r++}else{const t=te.PublicKey.fromString(o.recipient),a=(0,ee.splitPubKeyToScopeAndTableVec)(t);o.recipient=t.toString();while(1){const t=yield e.get_table_rows({code:e.chainParams.savpayContract,table:"pay2key",scope:String(a.scope),lower_bound:n,json:!1,limit:200});if(t&&"rows"in t&&t.rows.length>0){for(const n of t.rows){const t=(0,ne.rawSavActPaymentToObject)(n,ne.SavActPayTableType.pay2key);if(void 0!==t&&(t.from==i&&t.to==a.tableVec&&t.orisent==o.amount&&t.time==o.time&&Ce(t.memo,s)&&t.fund.symbol.precision==u.precision&&t.fund.symbol.name==u.name)){const a=t.fund.symbol,l={sender:o.sender,recipient:o.recipient,id:Number(t.id),fund:(0,X.AssetToString)(t.fund),orifund:(0,X.AssetToString)({amount:t.orisent,symbol:a}),memo:s,ramBy:t.ramBy,type:t.type,time:t.time,contract:t.contract,lastUpdate:Date.now(),removed:!1,chain:e.chainParams.shortName?e.chainParams.shortName:e.chainParams.chainId};return c.updateHistoryInTrx(o.recipient,l),c.updateHistoryOutTrx(o.sender,l),l}}const l=(0,ne.rawSavActPaymentToObject)(t.rows[t.rows.length-1],ne.SavActPayTableType.pay2key);l&&(n=String(l.id++))}if(!(r<21))return!1;yield(0,oe.sleep)(r<4?500:r<10?1e3:2e3),r++}}}catch(Fe){return se.log("Error on loadSavPayTrx",Fe),!1}}))}function De(){se.log("Go back",history.length,m.getRoutes()),history.length>1?m.back():m.push({name:"transfer"})}function Me(){var e;if(void 0==ue.value)return void j.Z.create({type:"negative",message:r("noChainDefined"),position:"top"});const t={payment:{to:ye.value,from:ve.value,amount:he.value,symbol:we.value,memo:xe},chainId:null===(e=ue.value)||void 0===e?void 0:e.chainId,show:!0};c.setWalletDialog(t)}const Ae=(0,Q.iH)(W||b.value||"string"!=typeof P.to||"t"in P||"T"in P||"dt"in P||"DT"in P),Ue=(0,Q.iH)(!1);function Oe(){return ce(this,void 0,void 0,(function*(){if(W&&void 0!==F){if(Ue.value)return!0;try{const e=ye.value.length<=13?(0,ee.nameToFromHex)(ye.value):(0,ee.hexWithTypeOfPubKey)(te.PublicKey.fromString(ye.value)),t=yield qe.value.get_table_rows({code:qe.value.chainParams.savpayContract,scope:qe.value.chainParams.savpayContract,table:"votes",lower_bound:F.toString(),upper_bound:F.toString(),limit:1,reverse:!0,show_payer:!1});if(t&&"rows"in t&&Array.isArray(t.rows)){if(t.rows.length>0){const o=t.rows[0];if("vid"in o&&"ramBy"in o&&"vt"in o&&"t"in o&&"rtoken"in o&&"rtcontract"in o)if(o.ramBy===ye.value&&""===o.holder||o.holder===e)if(o.vid===O&&o.vt===Math.floor(N)&&o.t===x.value&&o.rtcontract===fe.value&&o.options.length===E){const e=(0,X.StringToAsset)(o.rtoken);if((null===e||void 0===e?void 0:e.symbol.precision)===be.value&&(null===e||void 0===e?void 0:e.symbol.name)===we.value)return Ue.value=!0,!0;se.log("Different token symbol")}else se.log("Different public vote data");else se.log("Different holder")}Ue.value=!1,j.Z.create({type:"negative",message:r("invalidPublicVoteEntry"),position:"top"})}return!1}catch(Fe){se.log(Fe)}return Ue.value=!1,j.Z.create({type:"negative",message:r("errCheckPublicVoteEntry"),position:"top"}),!1}}))}function Ne(){const e=c.selectedConnect;if(!e)return void j.Z.create({type:"negative",message:r("noChainDefined"),position:"top"});const t={to:ye.value,from:ve.value.length>0?ve.value:void 0,t:b.value&&V.value?x.value:void 0,memo:Pe.value,pay:`${Ve.value} ${fe.value}`,chain:e.chainParams.shortName?e.chainParams.shortName:e.chainParams.chainId};p=t,De()}return(0,a.Jd)((()=>{void 0!==P.requestId&&u.updateBrowserPayment(P.requestId,!1,p)})),{t:r,brightStyle:y,selectMethod:de,chain:ue,connect:qe,sender:ve,recipient:ye,to:T,amount:he,fixed:be,symbol:we,tokenContract:fe,extraMemo:ke,memo:Pe,savPay:b,limit:V,confirm:_e,loadingConfirm:ge,walletStyle:h,quantity:Ve,walletLogout:c.walletLogout,showWalletDialog:c.showWalletDialog,walletUsers:f,walletUser:g,selectWallet:Me,inputsValid:k,showSymbol:v,showSender:z,isVote:W,voteOptions:M,voteTitle:I,selVote:A,showVoteDialog:D,shrinkText:ne.shrinkText,Screen:K.Z,decisionTime:H,voteEnd:Z,VoteColor:ie.VoteColor,savPayAvailable:Ae,alreadyPayed:Ne,showDateDialog:_,showSavActExplainDialog:S,showMemoExplainDialog:C}}});var de=o(11639),me=o(69885),ve=o(44458),pe=o(63190),ye=o(68879),ge=o(57691),fe=o(13119),he=o(22857),we=o(23175),be=o(32074),Ve=o(62146),xe=o(69984),ke=o.n(xe);const Te=(0,de.Z)(ue,[["render",O]]),Pe=Te;ke()(ue,"components",{QPage:me.Z,QCard:ve.Z,QCardSection:pe.Z,QBtn:ye.Z,QChip:ge.Z,QInput:fe.Z,QIcon:he.Z,QToggle:we.Z,QDialog:be.Z}),ke()(ue,"directives",{ClosePopup:Ve.Z})}}]);